<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wi-Fi Ayarları</title>
  <style>
    :root{
      --bg:#f0f0f0; --card:#fff; --border:#e6e6e6; --muted:#6b7280;
      --fg:#111; --accent:#4CAF50; --accent-2:#0ea5e9;
      --danger:#ef4444; --ring:rgba(76,175,80,.35)
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,system-ui,sans-serif;background:var(--bg);color:var(--fg)}
    .navbar{background:#333;color:#fff;padding:12px 16px;display:flex;gap:14px;align-items:center;position:sticky;top:0;z-index:10}
    .navbar a{color:#fff;text-decoration:none}
    .right{margin-left:auto}
    .wrap{max-width:980px;margin:20px auto;padding:0 16px}
    h1,h2{margin:12px 0;text-align:center}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;box-shadow:0 8px 20px rgba(0,0,0,.04)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){.grid2{grid-template-columns:1fr}}
    .subtle{color:var(--muted);font-size:14px}
    .btn{appearance:none;border:none;border-radius:999px;padding:10px 16px;cursor:pointer;font-weight:600}
    .btn:focus{outline:none;box-shadow:0 0 0 4px var(--ring)}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-outline{background:#fff;border:1px solid var(--border);color:#111}
    .btn-sky{background:var(--accent-2);color:#fff}
    .toolbar{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:6px 0 14px}
    /* görülen ağlar */
    .row{display:flex;align-items:center;gap:12px;border:1px solid var(--border);
         border-radius:12px;padding:12px 14px;margin:10px 0;background:#fff}
    .ssid{font-weight:700;flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .sig{display:flex;align-items:center;gap:10px}
    .bar{width:120px;height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%;width:0;background:var(--accent);transition:width .25s}
    .badge{font-size:12px;color:var(--muted)}
    form .fld{display:flex;flex-direction:column;gap:6px}
    input, select{padding:10px 12px;border-radius:10px;border:1px solid var(--border);outline:none}
    input:focus{box-shadow:0 0 0 4px rgba(14,165,233,.25);border-color:#bae6fd}
    .formgrid{display:grid;grid-template-columns:1fr 1fr auto;gap:10px}
    @media (max-width:720px){.formgrid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Üst çubuk: diğer sayfayla tutarlı -->
  <div class="navbar">
    <a href="{{ url_for('index') }}">SimClever</a>
    <a href="{{ url_for('index') }}">Video Stream</a>
    <a href="{{ url_for('control_wifi') }}">Wi-Fi Ayarları</a>
    <a href="{{ url_for('records.list_records') }}">Kayıtlar</a>
    <div class="right">
      {% set _user = session.get('user') or session.get('username') %}
      {% if _user %}
        <span>👤 {{ _user }}</span> · <a href="{{ url_for('logout') }}">Çıkış</a>
      {% else %}
        <a href="{{ url_for('login') }}">Giriş</a>
      {% endif %}
    </div>
  </div>

  <div class="wrap">
    <h1>Wi-Fi Ayarları</h1>

    <!-- Hızlı geçiş butonu -->
    <div class="toolbar">
      <a class="btn btn-sky" href="{{ url_for('index') }}">⬅️ Video Akışına Dön</a>
    </div>

    <div class="grid2">
      <!-- Bağlı ağ kartı -->
      <div class="card">
        <h2>Bağlı Ağ</h2>
        <p class="subtle" style="text-align:center;margin-top:6px">Cihazın şu an bağlı olduğu SSID</p>
        <p style="text-align:center;font-size:20px;font-weight:800;margin:10px 0 0">
          {{ connected_network if connected_network else "—" }}
        </p>
      </div>

      <!-- Bağlan formu -->
      <div class="card">
        <h2>Ağa Bağlan</h2>
        <p class="subtle" style="text-align:center;margin-top:6px">SSID seçin ya da yazın; parolayı girin.</p>
        <form method="post" action="{{ url_for('change_wifi') }}" style="margin-top:10px">
          <div class="formgrid">
            <div class="fld">
              <label for="ssid" class="subtle">SSID</label>
              <input id="ssid" name="ssid" list="ssid_list" placeholder="Ağ adı" required>
              <datalist id="ssid_list">
                {% for n in wifi_networks %}
                  <option value="{{ n.SSID }}"></option>
                {% endfor %}
              </datalist>
            </div>
            <div class="fld">
              <label for="password" class="subtle">Şifre</label>
              <input id="password" name="password" type="password" placeholder="Parola" required>
            </div>
            <div class="fld" style="justify-content:flex-end">
              <button class="btn btn-primary" type="submit" style="width:100%">Bağlan</button>
            </div>
          </div>
          {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
        </form>
      </div>
    </div>

    <!-- Görülen ağlar -->
    <div class="card" style="margin-top:18px">
      <h2>Görülen Ağlar</h2>
      <p class="subtle" style="text-align:center;margin-top:6px">Yakındaki erişim noktaları (güce göre sıralı)</p>

      {% if wifi_networks %}
        {% for n in wifi_networks %}
          {% set q = (n.Quality or 0)|int %}
          {% set pct = (q * 20) %}
          <div class="row">
            <span class="ssid">{{ n.SSID }}</span>
            <span class="sig">
              <span class="bar" aria-label="Sinyal Kalitesi">
                <span style="width: {{ pct }}%"></span>
              </span>
              <span class="badge">
                {% if n.dBm is defined and n.dBm is not none %}
                  {{ '%.0f'|format(n.dBm) }} dBm
                {% endif %}
                ({{ q }}/5)
              </span>
            </span>
          </div>
        {% endfor %}
      {% else %}
        <p class="subtle" style="text-align:center">Yakındaki ağ bulunamadı.</p>
      {% endif %}
    </div>

    <!-- Alt kısım kısa kısayollar -->
    <div class="toolbar" style="margin-top:18px">
      <a class="btn btn-outline" href="{{ url_for('index') }}">⬅️ Video Akışı</a>
      <a class="btn btn-outline" href="{{ url_for('control_wifi') }}">↻ Yenile</a>
      <a class="btn btn-outline" href="{{ url_for('records.list_records') }}">🎞 Kayıtlar</a>
    </div>
  </div>
</body>
</html>
