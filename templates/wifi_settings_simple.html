<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wi-Fi Ayarları</title>
  <style>
    :root{--bg:#f6f7f9;--card:#fff;--border:#e5e7eb;--muted:#6b7280;--fg:#111;--accent:#111827}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .wrap{max-width:820px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;box-shadow:0 8px 20px rgba(0,0,0,.04)}
    h1{margin:12px 0;text-align:center}
    .row{display:flex;gap:12px;align-items:center;justify-content:center;margin:10px 0}
    .radio{display:flex;gap:8px;align-items:center;cursor:pointer}
    select,input{padding:10px 12px;border:1px solid var(--border);border-radius:10px;min-width:140px}
    button{appearance:none;border:none;border-radius:10px;padding:10px 16px;background:var(--accent);color:#fff;cursor:pointer;font-weight:600}
    .muted{color:var(--muted);font-size:14px;text-align:center}
    .toolbar{display:flex;gap:10px;justify-content:center;margin:10px 0}
  </style>
</head>
<body>
  <div class="toolbar" style="margin-top:10px">
    <a href="{{ url_for('index') }}" style="text-decoration:none">
      ⬅️ Video Akışına Dön
    </a>
  </div>

  <div class="wrap">
    <h1>Wi-Fi Ayarları</h1>
    <div class="card">
      <form method="post" action="{{ url_for('apply_band_channel') }}">
        <!-- Bant -->
        <div class="row" style="margin-top:6px">
          <label class="radio">
            <input type="radio" name="band" value="2.4" {% if band=='2.4' %}checked{% endif %}> 2.4&nbsp;GHz
          </label>
          <label class="radio">
            <input type="radio" name="band" value="5" {% if band=='5' %}checked{% endif %}> 5&nbsp;GHz
          </label>
        </div>

        <!-- Kanal -->
        <div class="row">
          <label for="channel" class="muted" style="min-width:70px;text-align:right">Kanal</label>
          <select id="channel" name="channel"></select>
        </div>

        <!-- Gönder -->
        <div class="row" style="margin-top:8px">
          <button type="submit">Uygula</button>
        </div>

        {# Flask-WTF varsa CSRF token’ı ekle; yoksa bu blok zaten atlanır #}
        {% if csrf_token %}
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}
      </form>

      <p class="muted" style="margin-top:12px">
        Not: Değişiklik sonrası erişim noktası kısa süreli yeniden başlatılabilir.
      </p>
    </div>
  </div>

  <script>
    // Sunucudan gelen mevcut değerler:
    const currentBand = "{{ band }}";
    const currentCh   = {{ channel|int }};

    // Kanal listeleri: DFS dışı basit set
    const CHANNELS_24 = [{% for c in channels_24 %}{{ c }}{% if not loop.last %},{% endif %}{% endfor %}];
    const CHANNELS_5  = [{% for c in channels_5  %}{{ c }}{% if not loop.last %},{% endif %}{% endfor %}];

    const sel  = document.getElementById('channel');
    const band24 = document.querySelector('input[name="band"][value="2.4"]');
    const band5  = document.querySelector('input[name="band"][value="5"]');

    function fill(band, current){
      const list = band === '5' ? CHANNELS_5 : CHANNELS_24;
      sel.innerHTML = '';
      for (const c of list){
        const o = document.createElement('option');
        o.value = c; o.textContent = c;
        if (String(current) === String(c)) o.selected = true;
        sel.appendChild(o);
      }
    }

    // İlk yükleme
    fill(currentBand === '2.4' ? '2.4' : '5', currentCh || (currentBand === '2.4' ? 6 : 36));

    // Bant değişince kanal listesini yeniden doldur
    band24.addEventListener('change', ()=> fill('2.4', 6));
    band5 .addEventListener('change', ()=> fill('5', 36));
  </script>
</body>
</html>
