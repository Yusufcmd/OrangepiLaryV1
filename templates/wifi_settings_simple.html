<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wi-Fi Ayarları</title>
  <style>
    :root{--bg:#f6f7f9;--card:#fff;--border:#e5e7eb;--muted:#6b7280;--fg:#111;--accent:#111827}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    .wrap{max-width:820px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;box-shadow:0 8px 20px rgba(0,0,0,.04);margin-bottom:16px}
    h1{margin:12px 0;text-align:center}
    h2{margin:12px 0 8px;font-size:18px;color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center;justify-content:center;margin:10px 0}
    .radio{display:flex;gap:8px;align-items:center;cursor:pointer}
    select,input[type="text"],input[type="password"]{padding:10px 12px;border:1px solid var(--border);border-radius:10px;min-width:140px}
    input[type="password"]{min-width:200px}
    button{appearance:none;border:none;border-radius:10px;padding:10px 16px;background:var(--accent);color:#fff;cursor:pointer;font-weight:600}
    button:hover{opacity:0.9}
    .muted{color:var(--muted);font-size:14px;text-align:center}
    .toolbar{display:flex;gap:10px;justify-content:center;margin:10px 0}
    .divider{height:1px;background:var(--border);margin:16px 0}
    .flash-messages{max-width:820px;margin:0 auto 16px;padding:0 16px}
    .flash{padding:12px;border-radius:10px;margin-bottom:8px}
    .flash.success{background:#d1fae5;color:#065f46;border:1px solid #6ee7b7}
    .flash.error{background:#fee2e2;color:#991b1b;border:1px solid #fca5a5}
    .flash.warning{background:#fef3c7;color:#92400e;border:1px solid #fcd34d}
  </style>
</head>
<body>
  <div class="toolbar" style="margin-top:10px">
    <a href="{{ url_for('index') }}" style="text-decoration:none">
      ⬅️ Video Akışına Dön
    </a>
  </div>

  <!-- Flash mesajları -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="wrap">
    <h1>Wi-Fi Ayarları</h1>

    <!-- Band ve Kanal Ayarları -->
    <div class="card">
      <h2>Bant ve Kanal Ayarları</h2>
      <form method="post" action="{{ url_for('apply_band_channel') }}">
        <!-- Bant -->
        <div class="row" style="margin-top:6px">
          <label class="radio">
            <input type="radio" name="band" value="2.4" {% if band=='2.4' %}checked{% endif %}> 2.4&nbsp;GHz
          </label>
          <label class="radio">
            <input type="radio" name="band" value="5" {% if band=='5' %}checked{% endif %}> 5&nbsp;GHz
          </label>
        </div>

        <!-- Kanal -->
        <div class="row">
          <label for="channel" class="muted" style="min-width:70px;text-align:right">Kanal</label>
          <select id="channel" name="channel"></select>
        </div>

        <!-- Gönder -->
        <div class="row" style="margin-top:8px">
          <button type="submit">Bant/Kanal Uygula</button>
        </div>

        {# Flask-WTF varsa CSRF token'ı ekle; yoksa bu blok zaten atlanır #}
        {% if csrf_token %}
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}
      </form>
    </div>

    <!-- Şifre Değiştirme -->
    <div class="card">
      <h2>Wi-Fi Şifresi</h2>
      <form method="post" action="{{ url_for('apply_password') }}">
        <div class="row">
          <label for="current_pass" class="muted" style="min-width:100px;text-align:right">Mevcut Şifre</label>
          <input type="text" id="current_pass" value="{{ current_password }}" readonly style="background:#f3f4f6">
        </div>

        <div class="row">
          <label for="new_password" class="muted" style="min-width:100px;text-align:right">Yeni Şifre</label>
          <input type="password" id="new_password" name="password" placeholder="En az 8 karakter" required minlength="8" maxlength="63">
        </div>

        <div class="row" style="margin-top:8px">
          <button type="submit">Şifreyi Güncelle</button>
        </div>

        {% if csrf_token %}
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}
      </form>

      <p class="muted" style="margin-top:12px">
        Not: Şifre 8-63 karakter arasında olmalıdır. Değişiklik sonrası erişim noktası yeniden başlatılacaktır.
      </p>
    </div>

    <p class="muted" style="margin-top:12px">
      Not: Değişiklik sonrası erişim noktası kısa süreli yeniden başlatılabilir.
    </p>
  </div>

  <script>
    // Sunucudan gelen mevcut değerler:
    const currentBand = "{{ band }}";
    const currentCh   = {{ channel|int }};

    // Kanal listeleri: DFS dışı basit set
    const CHANNELS_24 = [{% for c in channels_24 %}{{ c }}{% if not loop.last %},{% endif %}{% endfor %}];
    const CHANNELS_5  = [{% for c in channels_5  %}{{ c }}{% if not loop.last %},{% endif %}{% endfor %}];

    const sel  = document.getElementById('channel');
    const band24 = document.querySelector('input[name="band"][value="2.4"]');
    const band5  = document.querySelector('input[name="band"][value="5"]');

    function fill(band, current){
      const list = band === '5' ? CHANNELS_5 : CHANNELS_24;
      sel.innerHTML = '';
      for (const c of list){
        const o = document.createElement('option');
        o.value = c; o.textContent = c;
        if (String(current) === String(c)) o.selected = true;
        sel.appendChild(o);
      }
    }

    // İlk yükleme
    fill(currentBand === '2.4' ? '2.4' : '5', currentCh || (currentBand === '2.4' ? 6 : 36));

    // Bant değişince kanal listesini yeniden doldur
    band24.addEventListener('change', ()=> fill('2.4', 6));
    band5 .addEventListener('change', ()=> fill('5', 36));
  </script>
</body>
</html>
