================================================================================
                    TÃœM API ENDPOINT'LERÄ° LÄ°STESÄ°
================================================================================

BASE URL: http://rtclary20050.local:7447/api/v1
TOKEN: ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

Ã–NEMLÄ°: TÃ¼m endpoint'ler token gerektirir!
Token 3 ÅŸekilde gÃ¶nderilebilir:
  1. Query parameter: ?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3
  2. Authorization header: Bearer ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3
  3. Sadece header: ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

================================================================================
                         KÄ°MLÄ°K DOÄRULAMA
================================================================================

1. LOGIN (Token Al)
   POST /api/v1/auth/login
   Body: {"username": "rise", "password": "simclever12345"}
   Response: {"success": true, "token": "ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"}

2. TOKEN DOÄRULAMA
   GET /api/v1/auth/verify?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3
   Response: {"success": true, "user": {"username": "rise"}}


================================================================================
                         OTURUM (SESSION) YÃ–NETÄ°MÄ°
================================================================================

3. TÃœM OTURUMLARI LÄ°STELE
   GET /api/v1/sessions?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Response:
   {
       "success": true,
       "active_session": "oturum5",
       "sessions": [
           {
               "name": "oturum5",
               "file_count": 3,
               "total_size": 15728640,
               "total_size_formatted": "15.00 MB",
               "last_modified": 1698765432.123,
               "last_modified_formatted": "2024-10-31 14:30:32"
           }
       ]
   }

4. OTURUM DETAYI (DosyalarÄ± Listele)
   GET /api/v1/sessions/<session_name>?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Ã–rnek:
   GET /api/v1/sessions/oturum1?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Response:
   {
       "success": true,
       "session": "oturum1",
       "is_active": false,
       "files": [
           {
               "name": "rec_20241031_143022.avi",
               "size": 5242880,
               "size_formatted": "5.00 MB",
               "modified": 1698765422.123,
               "modified_formatted": "2024-10-31 14:30:22",
               "download_url": "/api/v1/files/oturum1/rec_20241031_143022.avi"
           }
       ]
   }

5. OTURUM SÄ°L
   DELETE /api/v1/sessions/<session_name>?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Ã–rnek:
   DELETE /api/v1/sessions/oturum3?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Response: {"success": true, "message": "Oturum silindi"}

   NOT: Aktif oturum silinemez!


================================================================================
                         DOSYA YÃ–NETÄ°MÄ°
================================================================================

6. DOSYA Ä°NDÄ°R
   GET /api/v1/files/<session_name>/<filename>?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Ã–rnek:
   GET /api/v1/files/oturum1/rec_20241031_143022.avi?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Response: Video dosyasÄ± (binary download)

7. DOSYA SÄ°L
   DELETE /api/v1/files/<session_name>/<filename>?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Ã–rnek:
   DELETE /api/v1/files/oturum1/rec_20241031_143022.avi?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Response: {"success": true, "message": "Dosya silindi"}

8. DOSYA ADI DEÄÄ°ÅTÄ°R
   POST /api/v1/files/<session_name>/<filename>/rename?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3
   Body: {"new_name": "yeni_isim.avi"}

   Ã–rnek:
   POST /api/v1/files/oturum1/rec_20241031_143022.avi/rename?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3
   Body: {"new_name": "toplanti_kaydi"}

   Response: {"success": true, "message": "Dosya adÄ± deÄŸiÅŸtirildi", "new_name": "toplanti_kaydi.avi"}

   NOT: .avi uzantÄ±sÄ± otomatik eklenir


================================================================================
                         KAYIT KONTROLÃœ
================================================================================

9. KAYIT DURUMU SORGULA
   GET /api/v1/recording/status?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   TarayÄ±cÄ± URL:
   http://rtclary20050.local:7447/api/v1/recording/status?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

   Response:
   {
       "success": true,
       "recording": false,
       "current_file": null,
       "current_session": "oturum5",
       "fps": 18,
       "resolution": [640, 480]
   }

10. KAYIT BAÅLAT âœ… TARAYICIDAN ERÄ°ÅÄ°LEBÄ°LÄ°R
    GET veya POST /api/v1/recording/start?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    TarayÄ±cÄ± URL (GET):
    http://rtclary20050.local:7447/api/v1/recording/start?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    cURL (POST):
    curl -X POST "http://rtclary20050.local:7447/api/v1/recording/start?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

    Response: {"success": true, "message": "KayÄ±t baÅŸlatÄ±ldÄ± (manuel kontrol)"}

    Ã–NEMLÄ°: Manuel kontrol modu aktifleÅŸir ve GPIO watcher pasif hale gelir!
    GPIO kontrolÃ¼ne dÃ¶nmek iÃ§in sunucuyu restart edin.

11. KAYIT DURDUR âœ… TARAYICIDAN ERÄ°ÅÄ°LEBÄ°LÄ°R
    GET veya POST /api/v1/recording/stop?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    TarayÄ±cÄ± URL (GET):
    http://rtclary20050.local:7447/api/v1/recording/stop?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    cURL (POST):
    curl -X POST "http://rtclary20050.local:7447/api/v1/recording/stop?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

    Response: {"success": true, "message": "KayÄ±t durduruldu (manuel kontrol)"}


================================================================================
                         SÄ°STEM BÄ°LGÄ°LERÄ°
================================================================================

12. SÄ°STEM Ä°STATÄ°STÄ°KLERÄ°
    GET /api/v1/system/info?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    TarayÄ±cÄ± URL:
    http://rtclary20050.local:7447/api/v1/system/info?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    Response:
    {
        "success": true,
        "system": {
            "total_sessions": 5,
            "total_files": 23,
            "total_size": 157286400,
            "total_size_formatted": "150.00 MB",
            "records_directory": "/home/orangepi/clary/records",
            "active_session": "oturum5",
            "camera_status": "connected",
            "device_name": "rtclary20050",
            "storage": {
                "path": "/home/orangepi/clary/records",
                "total": 15999999999,
                "used": 7340032000,
                "free": 8659967999,
                "total_formatted": "14.91 GB",
                "used_formatted": "6.84 GB",
                "free_formatted": "8.07 GB",
                "used_percent": 45.79,
                "free_percent": 54.21
            }
        }
    }

    Not: storage alanÄ±, kayÄ±tlarÄ±n yazÄ±ldÄ±ÄŸÄ± disk (SD kart) Ã¼zerinde toplam/kullanÄ±lan/boÅŸ alan ve yÃ¼zde deÄŸerlerini iÃ§erir.


13. BATARYA DURUMU (PWM TabanlÄ±) ğŸ”‹
    GET /api/v1/system/battery?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    TarayÄ±cÄ± URL:
    http://rtclary20050.local:7447/api/v1/system/battery?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    Response:
    {
        "success": true,
        "battery": {
            "level": 85.3,
            "status": "good"
        }
    }

    NOT: GPIO 76'dan PWM sinyali ile batarya seviyesi okunur (0-100 arasÄ± yÃ¼zdelik).
    Status deÄŸerleri:
      - "good": %80 ve Ã¼zeri
      - "ok": %50-80 arasÄ±
      - "low": %20-50 arasÄ±
      - "critical": %20'nin altÄ±
      - "unknown": PWM okunamadÄ±

14. CÄ°HAZ Ä°SMÄ°NÄ° GETÄ°R ğŸ“±
    GET /api/v1/system/device-name?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    TarayÄ±cÄ± URL:
    http://rtclary20050.local:7447/api/v1/system/device-name?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

    Response:
    {
        "success": true,
        "device_name": "rtclary20050"
    }

15. CÄ°HAZ Ä°SMÄ°NÄ° DEÄÄ°ÅTÄ°R ğŸ“
    POST /api/v1/system/device-name?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3
    Body: {"device_name": "YeniCihazIsmi"}

    cURL Ã–rneÄŸi:
    curl -X POST "http://rtclary20050.local:7447/api/v1/system/device-name?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3" \
         -H "Content-Type: application/json" \
         -d '{"device_name": "OrangePi-Lary-001"}'

    Response:
    {
        "success": true,
        "message": "Cihaz ismi deÄŸiÅŸtirildi (kalÄ±cÄ± olmasÄ± iÃ§in sistem yeniden baÅŸlatÄ±lmalÄ±)",
        "device_name": "OrangePi-Lary-001"
    }

    NOT: Hostname maksimum 63 karakter olabilir.


================================================================================
                    TARAYICIDAN DOÄRUDAN ERÄ°ÅÄ°M Ã–RNEKLERÄ°
================================================================================

AÅŸaÄŸÄ±daki URL'leri tarayÄ±cÄ±nÄ±za yapÄ±ÅŸtÄ±rarak test edebilirsiniz:

âœ“ TÃ¼m OturumlarÄ± GÃ¶r:
  http://rtclary20050.local:7447/api/v1/sessions?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

âœ“ KayÄ±t Durumunu Kontrol Et:
  http://rtclary20050.local:7447/api/v1/recording/status?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

âœ“ Sistem Ä°statistikleri:
  http://rtclary20050.local:7447/api/v1/system/info?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

âœ“ Batarya Durumu:
  http://rtclary20050.local:7447/api/v1/system/battery?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

âœ“ Cihaz Ä°smi:
  http://rtclary20050.local:7447/api/v1/system/device-name?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3


================================================================================
                    MOBÄ°L UYGULAMA Ä°Ã‡Ä°N KULLANIM
================================================================================

Mobil uygulamada Authorization header kullanÄ±n:

Header: Authorization: Bearer ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3

Ã–rnek (JavaScript/React Native):
```javascript
fetch('http://rtclary20050.local:7447/api/v1/sessions', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3'
    }
})
.then(response => response.json())
.then(data => console.log(data));
```

KayÄ±t BaÅŸlatma Ã–rneÄŸi:
```javascript
fetch('http://rtclary20050.local:7447/api/v1/recording/start', {
    method: 'POST',
    headers: {
        'Authorization': 'Bearer ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3'
    }
})
.then(response => response.json())
.then(data => {
    if (data.success) {
        console.log('KayÄ±t baÅŸladÄ±!');
    }
});
```

Ã–rnek (Swift/iOS):
```swift
var request = URLRequest(url: url)
request.setValue("Bearer ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3",
                 forHTTPHeaderField: "Authorization")
request.httpMethod = "POST"
```

Ã–rnek (Kotlin/Android):
```kotlin
val request = Request.Builder()
    .url(url)
    .addHeader("Authorization", "Bearer ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3")
    .post(RequestBody.create(null, ByteArray(0)))
    .build()
```


================================================================================
                    CURL KOMUTLARI (TEST Ä°Ã‡Ä°N)
================================================================================

# TÃ¼m OturumlarÄ± Listele
curl "http://rtclary20050.local:7447/api/v1/sessions?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# KayÄ±t Durumu
curl "http://rtclary20050.local:7447/api/v1/recording/status?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# KayÄ±t BaÅŸlat (GET)
curl "http://rtclary20050.local:7447/api/v1/recording/start?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# KayÄ±t BaÅŸlat (POST)
curl -X POST "http://rtclary20050.local:7447/api/v1/recording/start?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# KayÄ±t Durdur (GET)
curl "http://rtclary20050.local:7447/api/v1/recording/stop?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# KayÄ±t Durdur (POST)
curl -X POST "http://rtclary20050.local:7447/api/v1/recording/stop?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# Dosya Ä°ndir
curl -O "http://rtclary20050.local:7447/api/v1/files/oturum1/video.avi?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# Dosya Sil
curl -X DELETE "http://rtclary20050.local:7447/api/v1/files/oturum1/video.avi?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# Oturum Sil
curl -X DELETE "http://rtclary20050.local:7447/api/v1/sessions/oturum3?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3"

# Dosya AdÄ± DeÄŸiÅŸtir
curl -X POST "http://rtclary20050.local:7447/api/v1/files/oturum1/video.avi/rename?token=ZUqwfoe1uyxZvSf2lYzH8fVDRdPP3UO3" \
  -H "Content-Type: application/json" \
  -d '{"new_name": "yeni_isim"}'


================================================================================
                    HIZLI REFERANS TABLOSU
================================================================================

| # | METHOD      | ENDPOINT                           | TARAYICI | AÃ‡IKLAMA                    |
|---|-------------|------------------------------------|----------|----------------------------|
| 1 | POST        | /api/v1/auth/login                | âŒ       | GiriÅŸ yap, token al        |
| 2 | GET         | /api/v1/auth/verify               | âœ…       | Token doÄŸrula              |
| 3 | GET         | /api/v1/sessions                  | âœ…       | TÃ¼m oturumlarÄ± listele     |
| 4 | GET         | /api/v1/sessions/<name>           | âœ…       | Oturum detayÄ± + dosyalar   |
| 5 | DELETE      | /api/v1/sessions/<name>           | âŒ       | Oturum sil                 |
| 6 | GET         | /api/v1/files/<session>/<file>    | âœ…       | Dosya indir                |
| 7 | DELETE      | /api/v1/files/<session>/<file>    | âŒ       | Dosya sil                  |
| 8 | POST        | /api/v1/files/<s>/<f>/rename      | âŒ       | Dosya adÄ±nÄ± deÄŸiÅŸtir       |
| 9 | GET         | /api/v1/recording/status          | âœ…       | KayÄ±t durumu sorgula       |
| 10| GET/POST    | /api/v1/recording/start           | âœ…âœ…     | KaydÄ± baÅŸlat               |
| 11| GET/POST    | /api/v1/recording/stop            | âœ…âœ…     | KaydÄ± durdur               |
| 12| GET         | /api/v1/system/info               | âœ…       | Sistem istatistikleri      |
| 13| GET         | /api/v1/system/battery            | âœ…       | Batarya durumunu sorgula   |
| 14| GET         | /api/v1/system/device-name        | âœ…       | Cihaz ismini sorgula       |
| 15| POST        | /api/v1/system/device-name        | âŒ       | Cihaz ismini deÄŸiÅŸtir      |

âœ… = TarayÄ±cÄ±dan doÄŸrudan eriÅŸilebilir (GET metodu)
âŒ = cURL, Postman veya mobil uygulama gerekli (POST/DELETE metodu)

================================================================================

TOPLAM: 15 Endpoint

Kimlik DoÄŸrulama: 2 endpoint
Oturum YÃ¶netimi: 3 endpoint
Dosya YÃ¶netimi: 3 endpoint
KayÄ±t KontrolÃ¼: 3 endpoint (âœ… 2 tanesi tarayÄ±cÄ±dan Ã§alÄ±ÅŸÄ±r!)
Sistem Bilgisi: 2 endpoint (Batarya durumu ve cihaz ismi eklendi)

================================================================================
                    Ã–NEMLÄ° NOTLAR VE Ä°PUÃ‡LARI
================================================================================

1. KAYIT KONTROLÃœ - MANUEL MOD:
   - /recording/start Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda MANUEL KONTROL MODU aktifleÅŸir
   - GPIO watcher pasif hale gelir (GPIO 260 artÄ±k etkisiz)
   - KayÄ±t API Ã¼zerinden kontrol edilir
   - GPIO kontrolÃ¼ne dÃ¶nmek iÃ§in sunucuyu RESTART edin

2. TOKEN GÃœVENLÄ°ÄÄ°:
   - Token URL'de gÃ¶rÃ¼nÃ¼r (query parameter)
   - Ãœretim ortamÄ±nda HTTPS kullanÄ±n
   - Token'Ä± gÃ¼venli yerde saklayÄ±n

3. TARAYICI TESTÄ°:
   - GET metodlarÄ± direkt tarayÄ±cÄ±dan Ã§alÄ±ÅŸÄ±r
   - POST/DELETE metodlarÄ± iÃ§in Postman veya cURL kullanÄ±n
   - TarayÄ±cÄ± eklentileri (REST Client) ile POST yapabilirsiniz

4. HATA MESAJLARI:
   - "Token bulunamadÄ±" â†’ ?token=xxx ekleyin
   - "Token geÃ§ersiz" â†’ Token'Ä± kontrol edin
   - "KayÄ±t zaten aktif" â†’ Ã–nce /recording/stop Ã§aÄŸÄ±rÄ±n
   - "KayÄ±t modÃ¼lÃ¼ kullanÄ±lamÄ±yor" â†’ recordsVideo.py yÃ¼klenememiÅŸ

5. KAYIT SÃœRESÄ°:
   - 2 saniyeden kÄ±sa videolar otomatik silinir
   - MIN_VIDEO_DURATION=2.0 (environment variable)

6. LOG TAKÄ°BÄ°:
   Orange Pi Ã¼zerinde:
   tail -f logs/clary_$(date +%Y-%m-%d).log

================================================================================
                              LÄ°STE SONU
================================================================================

Son GÃ¼ncelleme: 2025-01-30
Versiyon: 1.1
Ã–zellik: KayÄ±t kontrolÃ¼ GET metodu eklendi, tarayÄ±cÄ± desteÄŸi geliÅŸtirildi
